!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.JSGameTools=i():t.JSGameTools=i()}(window,(function(){return function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);var n={Setting:{FONT_FAMILY:"sans-serif",FONT_SIZE:32,CARS_TO_PRERENDER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","Ã—"]},Key:{UP:38,RIGHT:39,BOTTOM:40,LEFT:37,ENTER:13}},s={preRenderedFont:{},lastKey:-1,preRenderFont:function(t,i,e,n){t.push("?"),t.push(" "),t.push("A");for(var s=0;s<t.length;s++){var l=document.createElement("canvas"),h=l.getContext("2d");h.font=i+"px "+n;var o=h.measureText(t[s]).width;l.width=o,l.height=i+i/6,h.font=i+"px "+n,h.fillStyle=e,h.textBaseline="top",h.fillText(t[s],0,0),this.preRenderedFont[t[s]]=l}},drawImage:function(t,i,e,n,s,l,h,o,a,r,u,d){this.drawImageWrapper(t,i,e,n,s,l,h,o,a,r,u,d)},drawImageData:function(t,i,e,n,s,l,h,o,a,r,u,d){this.drawImageWrapper(t,i,e,n,s,l,h,o,a,r,u,d)},drawImageWrapper:function(t,i,e,n,s,l,h,o,a,r,u,d){e=null==e||isNaN(e)?null:Math.round(e),n=null==n||isNaN(n)?null:Math.round(n),s=null==s||isNaN(s)?null:Math.round(s),l=null==l||isNaN(l)?null:Math.round(l),h=null==h||isNaN(h)?null:Math.round(h),o=null==o||isNaN(o)?null:Math.round(o),a=null==a||isNaN(a)?null:Math.round(a),r=null==r||isNaN(r)?null:Math.round(r),u=null!=u&&u;null!=(d=null==d||isNaN(d)?null:d)&&(t.save(),t.translate(e+s/2,n+l/2),t.rotate(d*Math.PI/180),e=-s/2,n=-l/2),u&&t.clearRect(e,n,s,l),null!=t&&null!=i&&(null!=h&&null!=o&&null!=a&&null!=r?t.drawImage(i,h,o,a,r,e,n,s,l):t.drawImage(i,e,n,s,l)),null!=d&&t.restore()},drawText:function(t,i,e,n,s,l,h,o,a,r,u){var d=t.fillStyle,c=t.font,g=t.filter;Array.isArray(e)||(t.fillStyle=e),t.font=(u?"bold ":"")+n+"px "+s,t.filter="none",r&&(i=this.wrapTextLines(t,i).text);var f=i.split("\n");"center"==h?a=t.canvas.height/2-n*f.length/2:"top"==h?a=5:"bottom"==h&&(a=t.canvas.height-n*f.length/2-n/5);for(var m=0;m<f.length;m++){var v=f[m];if(Array.isArray(e)){var w=m;w>e.length-1&&(w=e.length-1),t.fillStyle=e[w]}"center"==l?t.fillText(v,Math.round(t.canvas.width/2-t.measureText(v).width/2),Math.round(a+n*m)):"right"==l?t.fillText(v,Math.round(t.canvas.width-t.measureText(v).width-15),Math.round(a+n*m)):"left"==l?t.fillText(v,5,Math.round(a+n*m)):t.fillText(v,Math.round(o),Math.round(a+n*m))}return t.fillStyle=d,t.font=c,t.filter=g,{x:o,y:a,height:n*f.length}},drawTextBitmap:function(t,i,e,s,l,h,o){if(null!=i&&null!=i||(this.preRenderedFont={},DrawUtils.preRenderFont(n.Setting.CARS_TO_PRERENDER,2*n.Setting.FONT_SIZE,"white",n.Setting.FONT_FAMILY),i=this.preRenderedFont),o){var a=i.A;e=this.wrapTextLines(t,e,a.width*(s/a.height),s).text}for(var r=e.split("\n"),u=h,d=0;d<r.length;d++){for(var c=r[d],g=l,f=0;f<c.length;f++){var m=c.charAt(f);if(null==i[m]||null==i[m])var v=i["?"];else v=i[m];var w=v.width*(s/v.height);DrawUtils.drawImageData(t,v,g,u,w,s,0,0,v.width,v.height),g+=w}c.length>0&&(u+=s)}},wrapText:function(t,i){if(t.length>i){for(var e=i;e>0&&" "!=t[e];e--);if(e>0){var n=t.substring(0,e),s=t.substring(e+1);return n+"\n"+this.wrapText(s,i)}}return t},wrapTextLines:function(t,i,e,n){for(var s=i.split("\n"),l="",h=e||t.measureText("A").width,o=Math.round(t.canvas.width/h),a=0,r=0;r<s.length;r++){var u=this.wrapText(s[r],o);l+=u,r<s.length-1&&(l+="\n");for(var d=0;d<u.split("\n").length;d++)a+=parseFloat(n)}return{text:l,height:a}},drawArrow:function(t,i,e,n,s){var l=t.lineCap,h=t.lineWidth,o=t.strokeStyle,a=t.filter;t.lineCap="round",t.lineWidth=8,t.strokeStyle="#FF0000",t.filter="",t.beginPath();var r=n-i,u=s-e,d=Math.atan2(u,r);t.moveTo(i,e),t.lineTo(n,s),t.moveTo(n,s),t.lineTo(n-20*Math.cos(d-Math.PI/6),s-20*Math.sin(d-Math.PI/6)),t.moveTo(n,s),t.lineTo(n-20*Math.cos(d+Math.PI/6),s-20*Math.sin(d+Math.PI/6)),t.stroke(),t.lineCap=l,t.lineWidth=h,t.strokeStyle=o,t.filter=a},clear:function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)},isFilterHueAvailable:function(){var t=document.createElement("canvas");t.width=5,t.height=5;var i=t.getContext("2d");i.fillStyle="#FF0000",i.filter="hue-rotate(90deg)",i.fillRect(0,0,5,5);var e=i.getImageData(0,0,1,1).data;return 255!=e[0]||0!=e[1]||0!=e[2]},blurCanvas:function(t,i){t.save(),t.filter="blur("+i+"px)",this.drawImageData(t,t.canvas,0,0,t.canvas.width,t.canvas.height),t.restore()}};class l{constructor(t,i,e,s,l,h,o,a,r,u,d,c,g,f,m){this.x=i||0,this.y=e||0,this.initialX=i,this.initialY=e,this.width=a||"auto",this.height=r||"auto",this.autoWidth="auto"==this.width,this.autoHeight="auto"==this.height,this.clicked=!1,this.hovered=!1,this.text=t,this.fontSize=u||Math.floor(n.Setting.FONT_SIZE/1.25),this.fontFamily=d||n.Setting.FONT_FAMILY,this.fontColor=c||"white",this.color=l||"rgba(0, 0, 0, 0)",this.colorHover=h||"#95a5a6",this.colorDown=o||"#727F80",this.triggerClick,this.triggerHover,this.triggerDown,this.init=!1,this.disabled=!1,this.alignement=s||"default",this.image,this.imgSrc=g,this.verticalAlignement=m||"default",this.selected=!1,this.imageLoader=f}draw(t){var i=t.canvas,e=(t=i.getContext("2d")).fillStyle,n=t.font;this.fontSize=this.getFontSize(t),t.font=this.fontSize+"px "+this.fontFamily;var l=t.measureText(this.text);if(null!=this.imgSrc&&null!=this.imageLoader&&this.loadImage(this.imageLoader),null!=this.image){var h=this.image.width,o=this.image.height;this.autoWidth&&(this.width=1.25*h),this.autoHeight&&(this.height=1.5*o)}else if(null!=this.text){var a=s.wrapTextLines(t,this.text,null,this.fontSize).height;this.autoWidth&&(this.width=l.width+25),this.autoHeight&&(this.height=a+this.fontSize/1.5)}if("center"==this.alignement?this.x=i.width/2-this.width/2-this.initialX:"right"==this.alignement?this.x=i.width-this.width-5-this.initialX:"left"==this.alignement&&(this.x=5),"bottom"==this.verticalAlignement?this.y=i.height-this.height-5-this.initialY:"center"==this.verticalAlignement?this.y=i.height/2-this.height/2-this.initialY:"top"==this.verticalAlignement&&(this.y=15),this.hovered&&this.clicked?t.fillStyle=this.colorDown:this.hovered?t.fillStyle=this.colorHover:t.fillStyle=this.color,t.fillRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height)),this.selected){var r=t.strokeStyle,u=t.lineWidth;t.strokeStyle="#a2cdd8",t.lineWidth=3,t.strokeRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height)),t.strokeStyle=r,t.lineWidth=u}if(null!=this.image){if(this.image.width>this.width||this.image.height>this.height){var d=this.image.width/this.image.height;h=Math.floor(this.width/1.25),o=Math.floor(h/d)}var c=this.x+this.width/2-h/2,g=this.y+this.height/2-o/2;t.drawImage(this.image,Math.round(c),Math.round(g),Math.round(h),Math.round(o))}else if(null!=this.text){t.fillStyle=this.fontColor;var f=this.x+this.width/2-l.width/2,m=this.y+this.fontSize+this.fontSize/5;s.drawText(t,this.text,this.fontColor,this.fontSize,this.fontFamily,"center"==this.alignement?"center":"default","default",Math.round(f),Math.round(m),!0)}if(t.fillStyle=e,t.font=n,!this.init&&null!=t){var v=this;t.canvas.addEventListener("mousemove",(function(i){v.disabled?(v.hovered=!1,v.clicked=!1):v.isInside(v.getMousePos(t.canvas,i))?(null==v.triggerHover||v.disabled||v.triggerHover(),v.hovered=!0):v.hovered=!1}),!1),t.canvas.addEventListener("click",(function(t){v.disabled?(v.hovered=!1,v.clicked=!1):v.isInside(v.getMousePos(i,t))?null!=v.triggerClick&&v.triggerClick():v.clicked=!1}),!1),t.canvas.addEventListener("mousedown",(function(t){v.disabled?(v.hovered=!1,v.clicked=!1):v.isInside(v.getMousePos(i,t))?(null!=v.triggerDown&&v.triggerDown(),v.clicked=!0):v.clicked=!1}),!1),t.canvas.addEventListener("mouseup",(function(t){v.clicked=!1}),!1)}this.init=!0}getFontSize(t){return Math.floor(parseInt(t.font.match(/\d+/),10)/1.25)}getMousePos(t,i){var e=t.getBoundingClientRect();return{x:i.clientX-e.left,y:i.clientY-e.top}}isInside(t){return t.x>this.x&&t.x<this.x+this.width&&t.y<this.y+this.height&&t.y>this.y}addClickAction(t){this.triggerClick=t}removeClickAction(t){t.triggerClick=null}addMouseOverAction(t){this.triggerHover=t}removeHoverAction(t){t.triggerHover=null}addMouseDownAction(t){this.triggerDown=t}removeDownAction(t){t.triggerDown=null}disable(){this.disabled=!0}enable(){this.disabled=!1}loadImage(t){this.image=t.get(this.imgSrc)}}class h{constructor(t,i,e,s,l,h,o,a,r,u){this.text=t,this.textColor=null==i?"rgba(255, 255, 255, 0.75)":i,this.backgroundColor=null==e?"rgba(46, 204, 113, 0.5)":e,this.delayBeforeClosing=null==s?5:s,this.fontSize=null==h?Math.floor(n.Setting.FONT_SIZE/1.25):h,this.fontFamily=null==o?n.Setting.FONT_FAMILY:o,this.animationDelay=null==l?500:l,this.foreGround=null!=a&&a,this.timeLastFrame=0,this.animationTime=0,this.init=!1,this.closed=!1,this.closing=!1,this.disableAnimation=null!=r&&r,this.closeButton=u}draw(t,i){var e=this;if(null!=this.text){var n=t.canvas;this.init||(this.timeLastFrame=Date.now()),this.closeButton=null!=i?i:this.closeButton,null!=this.closeButton&&this.closeButton.addClickAction((function(){e.close()}));var l=Date.now()-this.timeLastFrame;this.timeLastFrame=Date.now(),this.animationTime>=1e3*this.delayBeforeClosing&&!this.closing&&!this.closed&&this.close();t=n.getContext("2d");this.fontSize=1.25*this.getFontSize(t);var h=s.wrapTextLines(t,this.text,null,this.fontSize).height+this.fontSize/2,o=n.width,a=1;if(this.closing?this.disableAnimation?this.animationTime=-1:this.animationTime-=l:this.animationTime+=l,this.animationTime<0&&(this.closed=!0,this.closing=!1),this.closed)this.disableCloseButton();else{this.disableAnimation||(a=this.animationTime/this.animationDelay);var r=n.height-h*(a<=1?a:1);t.fillStyle=this.backgroundColor,t.fillRect(0,r,o,h),s.drawText(t,this.text,this.textColor,this.fontSize,this.fontFamily,"center","default",null,r+this.fontSize,!0),null!=this.close&&(this.closeButton.y=r+5),null!=this.closeButton&&this.closeButton.draw(t),this.disableCloseButton()}this.init=!0}}close(){this.disableCloseButton(),this.closing||(this.closing=!0,this.animationTime=this.animationDelay)}open(){this.timeLastFrame=0,this.animationTime=0,this.init=!1,this.closed=!1,this.closing=!1}disableCloseButton(){null!=this.closeButton&&null!=this.closeButton&&this.closeButton instanceof l&&this.closeButton.disable()}enableCloseButton(){null!=this.closeButton&&null!=this.closeButton&&this.closeButton instanceof l&&this.closeButton.enable()}copy(){return new h(this.text,this.textColor,this.backgroundColor,this.delayBeforeClosing,this.animationDelay,this.fontSize,this.fontFamily,this.foreGround)}getFontSize(t){return Math.floor(parseInt(t.font.match(/\d+/),10)/1.25)}}class o{constructor(t,i,e,s,l,h,o,a,r){this.buttons=t,this.text=i,this.colors=e,this.fontSize=s||Math.floor(n.Setting.FONT_SIZE/1.25),this.fontFamily=l||n.Setting.FONT_FAMILY,this.alignement=h||"center",this.x=o||0,this.backgroundColor=null==a?"rgba(44, 62, 80, 0.75)":a,this.blurCanvas=null!=r&&r,this.disabled=!1,this.lastKey=null==this.lastKey?-1:this.lastKey,this.selectedButton=null==this.selectedButton?0:this.selectedButton,this.init=null!=this.init&&this.init}draw(t,i){var e=this;if(!this.disabled){this.init||(document.addEventListener("keydown",(function(t){e.disabled||(e.lastKey=t.keyCode)})),this.init=!0),this.blurCanvas&&s.blurCanvas(t,5),t.fillStyle=this.backgroundColor,t.fillRect(0,0,t.canvas.width,t.canvas.height);var l=s.wrapTextLines(t,this.text,null,this.fontSize).height,h=0;if(null!=this.buttons){this.lastKey==n.Key.UP?this.selectedButton--:this.lastKey==n.Key.BOTTOM&&this.selectedButton++,this.selectedButton>=this.buttons.length?this.selectedButton=0:this.selectedButton<0&&(this.selectedButton=this.buttons.length-1);for(var o=0;o<this.buttons.length;o++)this.buttons[o].autoHeight?h+=s.wrapTextLines(t,this.buttons[o].text,null,this.buttons[o].getFontSize(t)).height+8:h+=this.buttons[o].height+5}var a=l+h,r=t.canvas.height/2-a/2+16,u=r+l;if(s.drawText(t,this.text,this.colors,this.fontSize,this.fontFamily,this.alignement,"default",this.x,r,!0),null!=this.buttons)for(o=0;o<this.buttons.length;o++){if(this.buttons[o].y=u,this.selectedButton==o?this.buttons[o].selected=!0:this.buttons[o].selected=!1,this.buttons[o].enable(),this.buttons[o].draw(t),this.selectedButton==o&&this.lastKey==n.Key.ENTER&&null!=this.buttons[o].triggerClick&&!this.buttons[o].disabled){this.lastKey=-1,this.selectedButton=0,this.buttons[o].triggerClick();break}u+=this.buttons[o].height+8}null!=i&&i(!0)}this.lastKey=-1}disable(){this.disabled=!0}enable(){this.disabled=!1}set(t,i,e,n,s){o.apply(this,[t,i,e,this.fontSize,this.fontFamily,n,s,this.backgroundColor,this.blurCanvas]),this.enable()}}i.default={Constants:n,Button:l,ButtonImage:class extends l{constructor(t,i,e,n,s,l,h,o,a,r){super(null,i,e,n,o,a,null,l,h,null,null,null,t,r,s)}},ImageLoader:class{constructor(){this.images={},this.triedLoading=0,this.hasError=!1,this.nbImagesToLoad=1,this.firstImage=!0}load(t,i,e){var n=this;if(this.firstImage&&(this.nbImagesToLoad=t.length,this.firstImage=!1),!(t.length>0))return i();this.loadImage(t[0],(function(s){if(1!=s)return n.hasError=!0,i();t.shift(),n.load(t,i,e)}))}loadImage(t,i){var e=this;this.triedLoading++;var n=new Image;n.src=t,n.onload=function(){return null==e.images?i(!1):(e.images[t]=n,e.triedLoading=0,i(!0))},n.onerror=function(){if(e.triedLoading>=5)return null!=e.images&&(e.images[t]=n),e.triedLoading=0,i(!1);setTimeout((function(){e.loadImage(t,i)}),250)}}get(t){return null!=this.images?this.images[t]:null}clear(){this.images=null}},NotificationMessage:h,DrawUtils:s,Menu:o}}])}));